# 贝叶斯滤波

贝叶斯滤波是解决滤波问题最基础的框架，卡尔曼滤波等都是贝叶斯滤波的推广或者特殊情况。贝叶斯滤波的核心思想是使用多变量贝叶斯公式(见下公式4)将**后验概率转化为先验概率与似然的乘积**，其包含预测和更新两个步骤：

- **预测**：利用n时刻之前的所有观测$y_{0:n-1}$​来计算先验概率分布$P(x_n|y_{0:n-1})$​
- 更新：利用n时刻获得的观测$y_n$​​得到似然概率$P(y_n|x_n)$​，并修正先验概率分布，从而得到最终的后验概率分布。

### 推导

考虑一个马尔科夫动态系统：

$P(x_0)$:			  状态的初始分布

$P(x_k|x_{k-1})$:	系统的**动态模型**，描述了系统的随机动态的过程。

$P(y_k|x_k)$:		系统的**测量模型**，给定了已知状态时的观测分布。

在这样的系统中存在两个基本假设：

1. **齐次马尔科夫假设**：即当前状态只与**前一时刻状态和当前的系统输入**有关，故$P(x_n|x_{n-1},y_{0:n-1})=P(x_n|x_{n-1})$。

2. **观测独立性假设**：任一时刻的观测只依赖于**该时刻**的马尔科夫链的状态，故$P(y_n|x_n,y_{0:n-1})=P(y_n|x_n)$。

**在预测步骤中**：

我们利用前一时刻的概率分布$P(x_{n-1}|y_{0:n-1})$来计算$P(x_n|y_{0:n-1})$，如下：
$$
P(x_n,x_{n-1}|y_{0:n-1})=P(x_n|x_{n-1},y_{0:n-1})P(x_{n-1}|y_{0:n-1})\label{1}
$$

1. 

根据**齐次马尔科夫假设**，公式 $\eqref{1}$可以改写为
$$
P(x_n,x_{n-1}|y_{0:n-1})=P(x_n|x_{n-1})P(x_{n-1}|y_{0:n-1})\label{2}
$$
由于$P(x_n|y_{0:n-1})$​是联合分布$P(x_n,x_{n-1}|y_{0:n-1})$​​​的边缘分布，因此对$x_{n-1}$积分可得$x_n$的边缘分布：
$$
\begin{equation}\begin{aligned}
P(x_{n}|y_{0:n-1})=\int P(x_n|x_{n-1})P(x_{n-1}|y_{0:n-1})dx_{n-1}\label{3}
\end{aligned}\end{equation}
$$
**在更新步骤中：**

我们利用$P(x_n|y_{0:n-1})$来计算$P(x_n|y_{0:n})$

在得到时刻n对应的观测$y_n$后，我们使用贝叶斯公式估计后验概率：
$$
\begin{equation}\begin{aligned}
\label{9} P(x_n|y_{0:n})=&\frac{P(x_n,y_n,y_{0:n-1})}{P(y_n,y_{0:n-1})}
\\
=&\frac{P(y_n|x_n,y_{0:n-1})P(x_n|y_{0:n-1})}{P(y_n|y_{0:n-1})}
\end{aligned}\end{equation}
$$
根据**观测独立性假设**，公式(4)​​​​​​​​​可以改写为：​
$$
P(x_n|y_{0:n})=\frac{P(y_n|x_n)P(x_n|y_{0:n-1})}{P(y_n|y_{0:n-1})}
$$
其中$P(y_n|y_{0:n-1})$​为归一化因子，其为联合分布$P(y_n,x_n|y_{0:n-1})$​的边缘分布。
$$
P(y_n,x_n|y_{0:n-1})=P(y_n|x_n,y_{0:n-1})P(x_n|y_{0:n-1})
=P(y_n|x_n)P(x_n|y_{0:n-1})
$$
故将联合分布对$x_n$积分可得边缘分布：
$$
P(y_n|y_{0:n-1})=\int P(y_n|x_n)P(x_n|y_{0:n-1}) dx_n
$$

------

### 缺点

贝叶斯滤波的缺点非常明显，预测步和更新步中各有一项无穷积分，然而在大多数情况下，积分是**没有解析式解**的，因此求解难度是非常大的。

考虑到积分的求解问题，一方面我们可以使用估计的方式求积分的近似解，例如使用蒙特卡罗积分；另一方面，我们可以给定额外的条件，帮助我们简化积分，例如假设系统的**动态模型**和测量模型都是**线性高斯的**(即：卡尔曼滤波)。

### 参考文献

[1] Simo Sarkka (2013). Bayesian Filtering and Smoothing. Cambridge University Press.

